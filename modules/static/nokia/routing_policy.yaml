prefix-set:
  - name: no_host_routes4
    prefix:
      - ip-prefix: "0.0.0.0/0"
        mask-length-range: 32..32
  - name: no_host_routes6
    prefix:
      - ip-prefix: "::/0"
        mask-length-range: 128..128
  - name: overlay_loopback4
    prefix:
      - ip-prefix: "10.64.168.0/24"
        mask-length-range: 32..32
  - name: overlay_loopback6
    prefix:
      - ip-prefix: "2620:0:861:130::/64"
        mask-length-range: 128..128

community-set:
  - name: GRACEFUL_SHUTDOWN
    member: ["65535:0"]
  - name: AVOIDED_PATH
    member: ["14907:0"]
  - name: BACKUP_PATH
    member: ["14907:1"]
  - name: SELECTED_PATH
    member: ["14907:11"]

policy:
  - name: ALL
    default-action:
      policy-result: accept

  - name: NONE
    default-action:
      policy-result: reject

  - name: evpn_external4_out
    default-action:
      policy-result: reject
    statement:
      - name: loopback4
        match:
          prefix-set: overlay_loopback4
        action:
          policy-result: accept
      - name: no_host_routes4
        match:
          prefix-set: no_host_routes4
          bgp:
            as-path-length:
              value: 0
        action:
          policy-result: reject
      - name: overlay_routes
        action:
          policy-result: accept

  - name: evpn_external6_out
    default-action:
      policy-result: reject
    statement:
      - name: loopback6
        match:
          prefix-set: overlay_loopback6
        action:
          policy-result: accept
      - name: no_host_routes6
        match:
          prefix-set: no_host_routes6
          bgp:
            as-path-length:
              value: 0
        action:
          policy-result: reject
      - name: overlay_routes
        action:
          policy-result: accept

  - name: evpn_external_in
    default-action:
      policy-result: accept
    statement:
      - name: graceful_shutdown
        match:
          bgp:
            community-set: GRACEFUL_SHUTDOWN
        action:
          bgp:
            local-preference:
              set: 0
      - name: localpref_avoid
        match:
          bgp:
            community-set: AVOIDED_PATH
        action:
          bgp:
            local-preference:
              set: 50
      - name: localpref_backup
        match:
          bgp:
            community-set: BACKUP_PATH
        action:
          bgp:
            local-preference:
              set: 70
      - name: localpref_prefer
        match:
          bgp:
            community-set: SELECTED_PATH
        action:
          bgp:
            local-preference:
              set: 350
